openapi: 3.0.3

info:
  title: Notification Service - Template APIs
  description: Template management and rendering APIs for Notification Service
  version: 1.0.0

servers:
  - url: http://localhost:8098/notify-srv/api/v1

tags:
  - name: Notifications
    description: Notification sending and scheduling

  - name: Templates
    description: Template management and rendering


paths:

  /notifications:
    post:
      tags: [Notifications]
      summary: Send notification immediately
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SendNotificationRequest"
      responses:
        "202":
          description: Notification accepted for sending
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationResponse"
        "400":
          description: Invalid request
        "500":
          description: Something went wrong on server
    get:
      tags: [Notifications]
      summary: List notifications with optional filters
      parameters:
        - name: status
          in: query
          required: false
          schema:
            type: string
            enum: [pending, sent, failed]
        - name: channel
          in: query
          required: false
          schema:
            type: string
            enum: [email, slack, in_app]
      responses:
        "200":
          description: List of notifications
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NotificationFullResponse"
        "500":
          description: Something went wrong on server

  /notifications/schedule:
    post:
      tags: [Notifications]
      summary: Schedule notification for later delivery
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ScheduleNotificationRequest"
      responses:
        "202":
          description: Notification scheduled successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationResponse"
        "400":
          description: Invalid request
        "500":
          description: Something went wrong on server

  /notifications/{id}:
    get:
      tags: [Notifications]
      summary: Get notification by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Notification details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationFullResponse"
        "400":
          description: Invalid notification ID
        "404":
          description: Notification not found
        "500":
          description: Something went wrong on server

  /templates:
    post:
      tags: [Templates]
      summary: Create a user-defined template
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTemplateRequest"
      responses:
        "201":
          description: Template created successfully
        "400":
          description: Invalid request
        "500":
          description: Something went wrong on server

  /templates/{channel}/{name}/versions:
    post:
      tags: [Templates]
      summary: Add a new version to a template
      parameters:
        - $ref: "#/components/parameters/Channel"
        - $ref: "#/components/parameters/TemplateName"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddVersionRequest"
      responses:
        "201":
          description: Version created
        "400":
          description: Invalid request
        "500":
          description: Something went wrong on server

    get:
      tags: [Templates]
      summary: List all versions of a template
      parameters:
        - $ref: "#/components/parameters/Channel"
        - $ref: "#/components/parameters/TemplateName"
      responses:
        "200":
          description: List of template versions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TemplateVersion"
        "400":
          description: Invalid request
        "500":
          description: Something went wrong on server

  /templates/{channel}/{name}:
    post:
      tags: [Templates]
      summary: Render a template (preview)
      parameters:
        - $ref: "#/components/parameters/Channel"
        - $ref: "#/components/parameters/TemplateName"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RenderTemplateRequest"
      responses:
        "200":
          description: Rendered template output
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RenderedTemplate"
        "400":
          description: Invalid request
        "500":
          description: Something went wrong on server

  /templates/summary:
    get:
      tags: [Templates]
      summary: List templates with active version
      description: >
        Returns all templates joined with their active version.
        This is a summary endpoint intended for admin and UI usage.
      parameters:
        - name: channel
          in: query
          required: false
          schema:
            type: string
            enum: [email, slack, in_app]
        - name: type
          in: query
          required: false
          schema:
            type: string
            enum: [system, user]
      responses:
        "200":
          description: List of templates with active version
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TemplateSummary"
        "500":
          description: Something went wrong on server

components:

  parameters:
    Channel:
      name: channel
      in: path
      required: true
      schema:
        type: string
        enum: [email, slack, in_app]

    TemplateName:
      name: name
      in: path
      required: true
      schema:
        type: string
        example: custom_welcome

  schemas:

    CreateTemplateRequest:
      type: object
      required: [name, channel]
      properties:
        name:
          type: string
          example: custom_welcome
        description:
          type: string
          example: User welcome email
        channel:
          type: string
          enum: [email, slack, in_app]

    AddVersionRequest:
      type: object
      required: [body]
      properties:
        subject:
          type: string
          example: Welcome {{.UserName}}
        body:
          type: string
          example: Hi {{.UserName}}, welcome to {{.AppName}}!

    RenderTemplateRequest:
      type: object
      required: [data]
      properties:
        data:
          type: object
          additionalProperties: true
          example:
            UserName: Kshitij
            AppName: NotifyX

    RenderedTemplate:
      type: object
      properties:
        subject:
          type: string
          example: Welcome Kshitij
        body:
          type: string
          example: Hi Kshitij, welcome to NotifyX!

    TemplateVersion:
      type: object
      properties:
        version:
          type: integer
          example: 2
        is_active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time

    TemplateSummary:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: custom_welcome
        description:
          type: string
          example: User welcome email
        channel:
          type: string
          enum: [email, slack, in_app]
        type:
          type: string
          enum: [system, user]
        active_version:
          type: integer
          example: 2
        subject:
          type: string
          nullable: true
          example: Welcome {{.UserName}}
        body:
          type: string
          example: Hi {{.UserName}}, welcome to {{.AppName}}!
        created_at:
          type: string
          format: date-time
          example: "2026-01-14T10:12:45Z"
        updated_at:
          type: string
          format: date-time
          example: "2026-01-14T10:15:02Z"

    SendNotificationRequest:
      type: object
      required:
        - channel
        - template_version_id
        - recipient
        - payload
      properties:
        channel:
          type: string
          enum: [email, slack, in_app]
        template_version_id:
          type: integer
          format: int64
          example: 12
        recipient:
          type: object
          additionalProperties:
            type: string
          example:
            email: user@example.com
        payload:
          type: object
          additionalProperties: true
          example:
            UserName: Kshitij

    ScheduleNotificationRequest:
      allOf:
        - $ref: "#/components/schemas/SendNotificationRequest"
        - type: object
          required:
            - scheduled_at
          properties:
            scheduled_at:
              type: string
              format: date-time
              example: "2026-01-15T10:00:00Z"

    NotificationResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 101
        status:
          type: string
          example: scheduled
      
    NotificationFullResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 101
        channel:
          type: string
          enum: [email, slack, in_app]
        template_version_id:
          type: integer
          format: int64
          example: 12
        recipient:
          type: object
          additionalProperties:
            type: string
          example:
            email:
        payload:
          type: object
          additionalProperties: true
          example:
            UserName: Kshitij
        status:
          type: string
          example: sent
        scheduled_at:
          type: string
          format: date-time
          example: "2026-01-15T10:00:00Z"
        sent_at:
          type: string
          format: date-time
          example: "2026-01-15T10:05:00Z"
        created_at:
          type: string
          format: date-time
          example: "2026-01-14T10:12:45Z"
        updated_at:
          type: string
          format: date-time
          example: "2026-01-14T10:15:02Z"


